{
  auto_https off
  admin off
}
:3000 {
  log {
    output stdout
    format console {
      time_format iso8601
      level_format color
    }
    level {$LOG_LEVEL}
  }
  root * /app/dist
  encode zstd gzip
  file_server
  @spa_router {
    not path /api/*
    file {
        try_files {path} /index.html
    }
  }
  rewrite @spa_router {http.matchers.file.relative}
  # Proxy requests to API service
  reverse_proxy /api/* {$BACKEND_URL} {
    header_up Host {http.reverse_proxy.upstream.hostport}
        header_up X-Forwarded-Host {host}
        header_up X-Forwarded-Proto {scheme}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Uri {uri}
        header_up X-Forwarded-Method {method}
        header_up X-Forwarded-Proto {scheme}
        header_up Authorization {http.request.header.Authorization}
        header_up Accept {http.request.header.Accept}
        header_up Content-Type {http.request.header.Content-Type}
        header_up Content-Length {http.request.header.Content-Length}
        header_up Cookie {http.request.header.Cookie}
        header_up X-Frame-Options {http.request.header.X-Frame-Options}
        header_up X-XSS-Protection {http.request.header.X-XSS-Protection}
        header_up Cache-Control {http.request.header.Cache-Control}
        header_up X-Content-Type-Options {http.request.header.X-Content-Type-Options}
        header_up Strict-Transport-Security {http.request.header.Strict-Transport-Security}
        header_up Content-Security-Policy {http.request.header.Content-Security-Policy}
        header_up Referrer-Policy {http.request.header.Referrer-Policy}
        header_up Feature-Policy {http.request.header.Feature-Policy}
  }
  header {
    X-Frame-Options "SAMEORIGIN"
    X-XSS-Protection "1;mode=block"
    Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate"
    X-Content-Type-Options "nosniff"
    Strict-Transport-Security "max-age=31536000"
    Content-Security-Policy "default-src 'self' https://spt.apps.gov.bc.ca data:; script-src 'self' 'unsafe-eval' https://www2.gov.bc.ca ;style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://use.fontawesome.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://fonts.googleapis.com http://www.w3.org https://*.gov.bc.ca"
    Referrer-Policy "same-origin"
    Feature-Policy "fullscreen 'self'; camera 'none'; microphone 'none'"
  }
}
:3001 {
  handle /health {
    respond "OK"
  }
}
